# =====================================================================
# Dockerfile.api — AgoMarket API (FastAPI)
# =====================================================================

FROM python:3.13.1-slim

# --------------------------------------------------------------------------
# 1. Dossier de travail
# --------------------------------------------------------------------------
WORKDIR /app

# --------------------------------------------------------------------------
# 2. Dépendances système (nécessaires pour psycopg, SQLAlchemy, etc.)
# --------------------------------------------------------------------------
RUN apt-get update && \ 
    apt-get install -y build-essential curl && \ 
    rm -rf /var/lib/apt/lists/*

# --------------------------------------------------------------------------
# 3. Installation des dépendances Python
# --------------------------------------------------------------------------
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# --------------------------------------------------------------------------
# 4. Copie du code applicatif
# --------------------------------------------------------------------------
COPY . .

# --------------------------------------------------------------------------
# 5. Commande de démarrage FastAPI
# --------------------------------------------------------------------------
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]